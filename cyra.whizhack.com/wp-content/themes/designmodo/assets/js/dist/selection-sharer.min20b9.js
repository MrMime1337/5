"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function($){var e=function e(t){var o=this;t=t||{},"string"==typeof t&&(t={elements:t}),this.sel=null,this.textSelection="",this.htmlSelection="",this.appId=$('meta[property="fb:app_id"]').attr("content")||$('meta[property="fb:app_id"]').attr("value"),this.url2share=$('meta[property="og:url"]').attr("content")||$('meta[property="og:url"]').attr("value")||window.location.href,this.getSelectionText=function(e){var t="",n="";if(e=e||window.getSelection(),e.rangeCount){for(var i=document.createElement("div"),r=0,s=e.rangeCount;r<s;++r)i.appendChild(e.getRangeAt(r).cloneContents());n=i.textContent,t=i.innerHTML}return o.textSelection=n,o.htmlSelection=t||n,n},this.selectionDirection=function(e){var t=e||window.getSelection(),o=document.createRange();if(!t.anchorNode)return 0;o.setStart(t.anchorNode,t.anchorOffset),o.setEnd(t.focusNode,t.focusOffset);var n=o.collapsed?"backward":"forward";return o.detach(),n},this.showPopunder=function(){o.popunder=o.popunder||document.getElementById("selectionSharerPopunder");var e=window.getSelection(),t=o.getSelectionText(e);if(e.isCollapsed||t.length<10||!t.match(/ /))return o.hidePopunder();if(o.popunder.classList.contains("fixed"))return o.popunder.style.bottom=0,o.popunder.style.bottom;var n=e.getRangeAt(0),i=n.endContainer.parentNode;if(o.popunder.classList.contains("show")){if(Math.ceil(o.popunder.getBoundingClientRect().top)==Math.ceil(i.getBoundingClientRect().bottom))return;return o.hidePopunder(o.showPopunder)}if(i.nextElementSibling)o.pushSiblings(i);else{o.placeholder||(o.placeholder=document.createElement("div"),o.placeholder.className="selectionSharerPlaceholder");var r=window.getComputedStyle(i).marginBottom;o.placeholder.style.height=r,o.placeholder.style.marginBottom=-2*parseInt(r,10)+"px",i.parentNode.insertBefore(o.placeholder)}var s=window.pageYOffset+i.getBoundingClientRect().bottom;o.popunder.style.top=Math.ceil(s)+"px",setTimeout(function(){o.placeholder&&o.placeholder.classList.add("show"),o.popunder.classList.add("show")},0)},this.pushSiblings=function(e){for(;e=e.nextElementSibling;)e.classList.add("selectionSharer"),e.classList.add("moveDown")},this.hidePopunder=function(e){if(e=e||function(){},"fixed"==o.popunder)return o.popunder.style.bottom="-50px",e();o.popunder.classList.remove("show"),o.placeholder&&o.placeholder.classList.remove("show");for(var t=document.getElementsByClassName("moveDown");el=t[0];)el.classList.remove("moveDown");setTimeout(function(){o.placeholder&&document.body.insertBefore(o.placeholder),e()},600)},this.show=function(e){setTimeout(function(){var t=window.getSelection(),n=o.getSelectionText(t);if(!t.isCollapsed&&n&&n.length>10&&n.match(/ /)){var i=t.getRangeAt(0),r=i.getBoundingClientRect().top-5,s=r+o.getPosition().y-o.$popover.height(),a=0;if(e)a=e.pageX;else{var l=t.anchorNode.parentNode;a+=l.offsetWidth/2;do{a+=l.offsetLeft}while(l=l.offsetParent)}switch(o.selectionDirection(t)){case"forward":a-=o.$popover.width();break;case"backward":a+=o.$popover.width();break;default:return}o.$popover.removeClass("anim").css("top",s+10).css("left",a).show(),setTimeout(function(){o.$popover.addClass("anim").css("top",s)},0)}},10)},this.hide=function(e){o.$popover.hide()},this.smart_truncate=function(e,t){if(!e||!e.length)return e;var o=e.length>t,n=o?e.substr(0,t-1):e;return n=o?n.substr(0,n.lastIndexOf(" ")):n,o?n+"...":n},this.getRelatedTwitterAccounts=function(){var e=[],t="designmodo";e.push(t);for(var o=document.getElementsByTagName("a"),n=0,i=o.length;n<i;n++)if(o[n].attributes.href&&"string"==typeof o[n].attributes.href.value){var r=o[n].attributes.href.value.match(/^https?:\/\/twitter\.com\/([a-z0-9_]{1,20})/i);r&&r.length>1&&-1==["widgets","intent"].indexOf(r[1])&&e.push(r[1])}return e.length>0?e.join(","):""},this.shareTwitter=function(e){e.preventDefault();var t="“"+o.smart_truncate(o.textSelection.trim(),254)+"”",n="http://twitter.com/intent/tweet?text="+encodeURIComponent(t)+"&related="+o.getRelatedTwitterAccounts()+"&url="+encodeURIComponent(o.url2share);o.viaTwitterAccount&&t.length<114-o.viaTwitterAccount.length&&(n+="&via="+o.viaTwitterAccount);var i=640,r=440,s=screen.width/2-320,a=screen.height/2-220-100;return window.open(n,"share_twitter","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=640, height=440, top="+a+", left="+s),o.hide(),!1},this.shareFacebook=function(e){e.preventDefault();var t=o.htmlSelection.replace(/<p[^>]*>/gi,"\n").replace(/<\/p>|  /gi,"").trim(),n="https://www.facebook.com/dialog/feed?app_id="+o.appId+"&display=popup&caption="+encodeURIComponent(t)+"&link="+encodeURIComponent(o.url2share)+"&href="+encodeURIComponent(o.url2share)+"&redirect_uri="+encodeURIComponent(o.url2share),i=640,r=440,s=screen.width/2-320,a=screen.height/2-220-100;window.open(n,"share_facebook","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=640, height=440, top="+a+", left="+s)},this.render=function(){o.$popover=$('<div class="selectionSharer" id="selectionSharerPopover" style="position:absolute;">  <div id="selectionSharerPopover-inner">    <ul>      <li><a class="action tweet" href="" title="Share this selection on Twitter" target="_blank"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#twitter"></use></svg></a></li><!--   --><li><a class="action facebook" href="" title="Share this selection on Facebook" target="_blank"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#facebook2"></use></svg></a></li>    </ul>  </div>  <div class="selectionSharerPopover-clip"><span class="selectionSharerPopover-arrow"></span></div></div>'),o.$popover.find("a.tweet").click(o.shareTwitter),o.$popover.find("a.facebook").click(o.shareFacebook),$("body").append(o.$popover),o.$popunder=$('<div id="selectionSharerPopunder" class="selectionSharer">  <div id="selectionSharerPopunder-inner">    <label>Share this selection</label>    <ul>      <li><a class="action tweet" href="" title="Share this selection on Twitter" target="_blank"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#twitter"></use></svg></a></li>      <li><a class="action facebook" href="" title="Share this selection on Facebook" target="_blank"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#facebook2"></use></svg></a></li>    </ul>  </div></div>'),o.$popunder.find("a.tweet").click(o.shareTwitter),o.$popunder.find("a.facebook").click(o.shareFacebook),o.appId&&o.url2share&&$(".selectionSharer a.facebook").css("display","inline-block")},this.setElements=function(e){"string"==typeof e&&(e=$(e)),o.$elements=e instanceof $?e:$(e),o.$elements.mouseup(o.show).mousedown(o.hide),o.$elements.bind("touchstart",function(e){o.isMobile=!0}),document.onselectionchange=o.selectionChanged},this.selectionChanged=function(e){o.isMobile&&(o.lastSelectionChanged&&clearTimeout(o.lastSelectionChanged),o.lastSelectionChanged=setTimeout(function(){o.showPopunder(e)},300))},this.getPosition=function(){var e=void 0!==window.pageXOffset,t="CSS1Compat"===(document.compatMode||"");return{x:e?window.pageXOffset:t?document.documentElement.scrollLeft:document.body.scrollLeft,y:e?window.pageYOffset:t?document.documentElement.scrollTop:document.body.scrollTop}},this.render(),t.elements&&this.setElements(t.elements)};$.fn.selectionSharer=function(){return(new e).setElements(this),this},"function"==typeof define?define(function(){return e.load=function(t,o,n,i){(new e).setElements("p"),n()},e}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e:window.SelectionSharer=e}(jQuery);